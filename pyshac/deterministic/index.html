



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for PySHAC, the Python library for Sequential Halving and Classification.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.4, mkdocs-material-2.9.1">
    
    
      
        <title>Deterministic Engines - PySHAC Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.ba0fd1a6.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="light-blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#deterministic-engines" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="PySHAC Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                PySHAC Documentation
              </span>
              <span class="md-header-nav__topic">
                Deterministic Engines
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/titu1994/pyshac/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    PySHAC Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/titu1994/pyshac/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../guide/" title="User Guide" class="md-nav__link">
      User Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../serial-execution/" title="Serial Evaluation" class="md-nav__link">
      Serial Evaluation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../managed/" title="Managed Engines" class="md-nav__link">
      Managed Engines
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Deterministic Engines
      </label>
    
    <a href="./" title="Deterministic Engines" class="md-nav__link md-nav__link--active">
      Deterministic Engines
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deterministic-behaviour-for-the-engine" title="Deterministic Behaviour for the Engine" class="md-nav__link">
    Deterministic Behaviour for the Engine
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-global-deterministic-behaviour" title="Setting Global Deterministic Behaviour" class="md-nav__link">
    Setting Global Deterministic Behaviour
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-local-deterministic-behaviour" title="Setting Local Deterministic Behaviour" class="md-nav__link">
    Setting Local Deterministic Behaviour
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restoring-engines-with-deterministic-behaviour" title="Restoring Engines with Deterministic Behaviour" class="md-nav__link">
    Restoring Engines with Deterministic Behaviour
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note" title="NOTE:" class="md-nav__link">
    NOTE:
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../custom-hyper-parameters/" title="Custom Hyper Parameters" class="md-nav__link">
      Custom Hyper Parameters
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../external-dataset-training/" title="External Dataset Training" class="md-nav__link">
      External Dataset Training
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../callbacks/" title="Callbacks" class="md-nav__link">
      Callbacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Config
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Config
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../config/hyperparameters/" title="Hyper Parameters" class="md-nav__link">
      Hyper Parameters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/data/" title="Datasets" class="md-nav__link">
      Datasets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/callbacks/" title="Callbacks" class="md-nav__link">
      Callbacks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Core
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Core
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../core/engine/" title="SHAC" class="md-nav__link">
      SHAC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core/torch_engine/" title="PyTorch SHAC" class="md-nav__link">
      PyTorch SHAC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core/tf_engine/" title="Tensorflow SHAC" class="md-nav__link">
      Tensorflow SHAC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core/keras_engine/" title="Keras SHAC" class="md-nav__link">
      Keras SHAC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Utils
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Utils
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../utils/vis_utils/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deterministic-behaviour-for-the-engine" title="Deterministic Behaviour for the Engine" class="md-nav__link">
    Deterministic Behaviour for the Engine
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-global-deterministic-behaviour" title="Setting Global Deterministic Behaviour" class="md-nav__link">
    Setting Global Deterministic Behaviour
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-local-deterministic-behaviour" title="Setting Local Deterministic Behaviour" class="md-nav__link">
    Setting Local Deterministic Behaviour
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restoring-engines-with-deterministic-behaviour" title="Restoring Engines with Deterministic Behaviour" class="md-nav__link">
    Restoring Engines with Deterministic Behaviour
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note" title="NOTE:" class="md-nav__link">
    NOTE:
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/titu1994/pyshac/edit/master/docs/deterministic.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="deterministic-engines">Deterministic Engines<a class="headerlink" href="#deterministic-engines" title="Permanent link">&para;</a></h1>
<hr />
<p><code>PySHAC</code>, on its own, uses no random seed to enable deterministic training or evaluation.
However, there are often the cases where experiments must be controlled, and it makes sense
to set the random seed for deterministic behaviour.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>PySHAC ignores the global numpy random seed. Therefore setting <code>np.random.seed(...)</code>
or <code>np.random.RandomState(...)</code> will <strong>not</strong> make the PySHAC engine or its components
deterministic.</p>
</div>
<h2 id="deterministic-behaviour-for-the-engine">Deterministic Behaviour for the Engine<a class="headerlink" href="#deterministic-behaviour-for-the-engine" title="Permanent link">&para;</a></h2>
<hr />
<p>Deterministic behaviour can be set in the engine either globally (all operations on the engine are
deterministic) or locally (engine is deterministic only inside the context block).</p>
<h3 id="setting-global-deterministic-behaviour">Setting Global Deterministic Behaviour<a class="headerlink" href="#setting-global-deterministic-behaviour" title="Permanent link">&para;</a></h3>
<p>Given we have initialized an engine as below (we use the basic <code>SHAC</code> engine here, but any engine
subclass can use the same API), we enable global deterministic behaviour as follows :</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">pyshac</span>

<span class="n">shac</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">SHAC</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># make engine deterministic</span>
<span class="n">shac</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>  <span class="c1"># an integer seed</span>
</pre></div>

<p>Once the seed has been set as such, all operations of the engine are deterministic globally until
either the engine is destroyed or we re-enable non-determinism in the engine as follows :</p>
<div class="codehilite"><pre><span></span><span class="n">shac</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>  <span class="c1"># use `None` to make the engine non deterministic again.</span>
</pre></div>

<h3 id="setting-local-deterministic-behaviour">Setting Local Deterministic Behaviour<a class="headerlink" href="#setting-local-deterministic-behaviour" title="Permanent link">&para;</a></h3>
<hr />
<p>Given we have initialized an engine as below (we use the basic <code>SHAC</code> engine here, but any engine
subclass can use the same API), we enable local deterministic behaviour using a context manager as
follows :</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">pyshac</span>

<span class="n">shac</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">SHAC</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">with</span> <span class="n">shac</span><span class="o">.</span><span class="n">as_deterministic</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>  <span class="c1"># deterministic only within this block</span>
    <span class="o">...</span>
</pre></div>

<h2 id="restoring-engines-with-deterministic-behaviour">Restoring Engines with Deterministic Behaviour<a class="headerlink" href="#restoring-engines-with-deterministic-behaviour" title="Permanent link">&para;</a></h2>
<hr />
<p>Engines can be saved and then restored as required by the engine, but by default, even restored engines
are non-deterministic. Deterministic behaviour must be reestablished, but in the proper order.</p>
<div class="codehilite"><pre><span></span><span class="c1"># First create a default engine without any hyper parameters.</span>
<span class="n">new_shac</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">SHAC</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">total_budget</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="n">objective</span><span class="p">)</span>

<span class="c1"># Restore the engine</span>
<span class="n">new_shac</span><span class="o">.</span><span class="n">restore_data</span><span class="p">()</span>

<span class="c1"># Restore deterministic behaviour now.</span>
<span class="n">new_shac</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</pre></div>

<h2 id="note"><strong>NOTE</strong>:<a class="headerlink" href="#note" title="Permanent link">&para;</a></h2>
<p>If the user attempts to set the seed before the engine has been restored, then the engine will issue
a warning stating that the engine had no hyper parameters which it could seed.</p>
<h1 id="deterministic-managed-engines">Deterministic Managed Engines<a class="headerlink" href="#deterministic-managed-engines" title="Permanent link">&para;</a></h1>
<hr />
<p>The managed engines which subclass <code>SHAC</code> also have full support for deterministic behaviour.</p>
<p>This entails :</p>
<ul>
<li><code>TensorflowSHAC</code>: Seeds the engine randomness as well as uses <code>tf.set_random_seed(seed)</code> to make the engine deterministic.</li>
<li><code>KerasSHAC</code>: Seeds the engine randomness as well as the Tensorflow seed when using the Tensorflow backend.</li>
<li><code>TorchSHAC</code>: Seeds the engine randomness as well as uses <code>np.random.seed()</code>, <code>torch.manual_seed()</code> and <code>torch.cuda.manual_seed_all()</code>.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../managed/" title="Managed Engines" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Managed Engines
              </span>
            </div>
          </a>
        
        
          <a href="../custom-hyper-parameters/" title="Custom Hyper Parameters" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Custom Hyper Parameters
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>