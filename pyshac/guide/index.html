



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for PySHAC, the Python library for Sequential Halving and Classification.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.4, mkdocs-material-2.9.1">
    
    
      
        <title>User Guide - PySHAC Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.ba0fd1a6.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="light-blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#guide" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="PySHAC Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                PySHAC Documentation
              </span>
              <span class="md-header-nav__topic">
                User Guide
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/titu1994/pyshac/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    PySHAC Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/titu1994/pyshac/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        User Guide
      </label>
    
    <a href="./" title="User Guide" class="md-nav__link md-nav__link--active">
      User Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#important-note-for-windows-platform" title="Important Note for Windows Platform" class="md-nav__link">
    Important Note for Windows Platform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#declaration-of-hyper-parameters" title="Declaration of Hyper Parameters" class="md-nav__link">
    Declaration of Hyper Parameters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#naming-hyper-parameters" title="Naming hyper parameters" class="md-nav__link">
    Naming hyper parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaring-hyper-parameters" title="Declaring hyper parameters" class="md-nav__link">
    Declaring hyper parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-of-models" title="Training of Models" class="md-nav__link">
    Training of Models
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-the-engine" title="Setting up the engine" class="md-nav__link">
    Setting up the engine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-the-classifiers" title="Training the classifiers" class="md-nav__link">
    Training the classifiers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sampling-the-best-hyper-parameters" title="Sampling the best hyper parameters" class="md-nav__link">
    Sampling the best hyper parameters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dealing-with-long-sampling-time" title="Dealing with long sampling time" class="md-nav__link">
    Dealing with long sampling time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continuing-training" title="Continuing Training" class="md-nav__link">
    Continuing Training
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../serial-execution/" title="Serial Evaluation" class="md-nav__link">
      Serial Evaluation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../managed/" title="Managed Engines" class="md-nav__link">
      Managed Engines
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../custom-hyper-parameters/" title="Custom Hyper Parameters" class="md-nav__link">
      Custom Hyper Parameters
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../external-dataset-training/" title="External Dataset Training" class="md-nav__link">
      External Dataset Training
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../callbacks/" title="Callbacks" class="md-nav__link">
      Callbacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Config
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Config
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../config/hyperparameters/" title="Hyper Parameters" class="md-nav__link">
      Hyper Parameters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/data/" title="Datasets" class="md-nav__link">
      Datasets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/callbacks/" title="Callbacks" class="md-nav__link">
      Callbacks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Core
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Core
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../core/engine/" title="SHAC" class="md-nav__link">
      SHAC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core/torch_engine/" title="PyTorch SHAC" class="md-nav__link">
      PyTorch SHAC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core/tf_engine/" title="Tensorflow SHAC" class="md-nav__link">
      Tensorflow SHAC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core/keras_engine/" title="Keras SHAC" class="md-nav__link">
      Keras SHAC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Utils
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Utils
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../utils/vis_utils/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#important-note-for-windows-platform" title="Important Note for Windows Platform" class="md-nav__link">
    Important Note for Windows Platform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#declaration-of-hyper-parameters" title="Declaration of Hyper Parameters" class="md-nav__link">
    Declaration of Hyper Parameters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#naming-hyper-parameters" title="Naming hyper parameters" class="md-nav__link">
    Naming hyper parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaring-hyper-parameters" title="Declaring hyper parameters" class="md-nav__link">
    Declaring hyper parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-of-models" title="Training of Models" class="md-nav__link">
    Training of Models
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-the-engine" title="Setting up the engine" class="md-nav__link">
    Setting up the engine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-the-classifiers" title="Training the classifiers" class="md-nav__link">
    Training the classifiers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sampling-the-best-hyper-parameters" title="Sampling the best hyper parameters" class="md-nav__link">
    Sampling the best hyper parameters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dealing-with-long-sampling-time" title="Dealing with long sampling time" class="md-nav__link">
    Dealing with long sampling time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continuing-training" title="Continuing Training" class="md-nav__link">
    Continuing Training
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/titu1994/pyshac/edit/master/docs/guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="guide">Guide<a class="headerlink" href="#guide" title="Permanent link">&para;</a></h1>
<hr />
<p>PySHAC has a very simple interface, which follows similar semantics to Scikit-Learn. Simply importing as below grants the majority of the functionality of the library.</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">pyshac</span>
</pre></div>

<p>There are three main processes that are followed when using PySHAC :</p>
<ul>
<li>
<p><strong>Declaration of hyper parameters</strong>:</p>
<ul>
<li>Hyper parameters can be discrete or continuous, and if continuous, be sampled from different distributions.</li>
<li>All hyper parameters must be defined before being passed to the engine.</li>
</ul>
</li>
<li>
<p><strong>Training of the models</strong>:</p>
<ul>
<li>Once the parameters are defined, we create an instance of the engine.</li>
<li>This engine is passed an evaluation function that the user must write, along with the hyper parameter declarations and other parameters as required (such as total budget and number of batches)</li>
<li>The engine's <code>fit()</code> method is used to perform training of the classifiers.</li>
<li>Training can be stopped at any time between epochs. All models are serialized at the end of each epoch.</li>
</ul>
</li>
<li>
<p><strong>Sampling the best hyper parameters</strong>:</p>
<ul>
<li>Using the serialized models, we can sample the search space in order to obtain the best hyper parameters possible.</li>
<li>This is done using the engine's <code>predict()</code> method.</li>
</ul>
</li>
</ul>
<h2 id="important-note-for-windows-platform">Important Note for Windows Platform<a class="headerlink" href="#important-note-for-windows-platform" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>fit</code> and <code>predict</code> methods <strong>must be called only from inside of a <code>if __name__ == '__main__'</code> block.</strong> when using the <strong>multiprocessing</strong> backend.
This is no longer an issue when using the <code>loky</code> backend (default).</p>
<p>This is a limitation of how Windows does not support forking, and so the engine definition and its methods must be called
inside of a <code>__main__</code> block when using the <code>multiprocessing</code> backend.</p>
<p>It is simpler to put this code inside of a function, and simply call this function from the <code>__main__</code> block
to have better readability of code.</p>
</div>
<h2 id="declaration-of-hyper-parameters">Declaration of Hyper Parameters<a class="headerlink" href="#declaration-of-hyper-parameters" title="Permanent link">&para;</a></h2>
<hr />
<p>There are 3 available hyper parameters made available :</p>
<ul>
<li><a href="../config/hyperparameters/#discretehyperparameter">DiscreteHyperParameter</a></li>
<li><a href="../config/hyperparameters/#uniformcontinuoushyperparameter">UniformContinuousHyperParameter</a></li>
<li><a href="../config/hyperparameters/#normalcontinuoushyperparameter">NormalContinuousHyperParameter</a></li>
</ul>
<p>There are also 3 additional hyper parameters, which are useful when a parameter needs to be sampled multiple times
for each evaluation :</p>
<ul>
<li><a href="../config/hyperparameters/#multidiscretehyperparameter">MultiDiscreteHyperParameter</a></li>
<li><a href="../config/hyperparameters/#multiuniformcontinuoushyperparameter">MultiUniformContinuousHyperParameter</a></li>
<li><a href="../config/hyperparameters/#multinormalcontinuoushyperparameter">MultiNormalContinuousHyperParameter</a></li>
</ul>
<p>These multi parameters have an additional argument <code>sample_count</code> which can be used to sample multiple times
per step.</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>The values will be concatenated linearly, so each multi parameter will have a list of values
returned in the resultant OrderedDict. If you wish to flatten the entire search space, you can
use <code>pyshac.flatten_parameters</code> on this OrderedDict.</p>
</div>
<p>While these can declare most of the common hyper parameters, if there is a need for custom hyper parameters, then they
can very easily be added as shown in <a href="../custom-hyper-parameters/">Custom Hyper Parameters</a>.</p>
<hr />
<h3 id="naming-hyper-parameters">Naming hyper parameters<a class="headerlink" href="#naming-hyper-parameters" title="Permanent link">&para;</a></h3>
<p>For the engine to work correctly, all hyper parameters must have <strong>unique names</strong> associated with them.</p>
<p>These names are the keyword arguments of the dictionary received by the evaluation function, so we can get the value
of the sample by this name inside the evaluation function.</p>
<hr />
<h3 id="declaring-hyper-parameters">Declaring hyper parameters<a class="headerlink" href="#declaring-hyper-parameters" title="Permanent link">&para;</a></h3>
<p>Declaring hyper parameters is as easy as follows :</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">pyshac</span>

<span class="c1"># Discrete parameters</span>
<span class="n">dice_rolls</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">DiscreteHyperParameter</span><span class="p">(</span><span class="s1">&#39;dice&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">coin_flip</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">DiscreteHyperParameter</span><span class="p">(</span><span class="s1">&#39;coin&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># Continuous Parameters</span>
<span class="n">classifier_threshold</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">UniformContinuousHyperParameter</span><span class="p">(</span><span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">NormalContinuousHyperParameter</span><span class="p">(</span><span class="s1">&#39;noise&#39;</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>

<h2 id="training-of-models">Training of Models<a class="headerlink" href="#training-of-models" title="Permanent link">&para;</a></h2>
<p>There are multiple engines available for use, and their use case differs based on what work is being done.
For this guide, we are considering our task will be accomplished with python classifiers (XGBoost, Scikit-Learn etc)
which do not depend on GPU acceleration.</p>
<p>However, when working with Tensorflow, PyTorch or Keras models, it is advisable to use the appropriate engine.
More information can be found in <a href="../managed/">Managed Engines</a>.</p>
<hr />
<h3 id="setting-up-the-engine">Setting up the engine<a class="headerlink" href="#setting-up-the-engine" title="Permanent link">&para;</a></h3>
<p>When setting up the SHAC engine, we need to define a few important parameters which will be used by the engine :</p>
<ul>
<li><strong>Hyper Parameter list</strong>: A list of parameters that have been declared. This will constitute the search space.</li>
<li><strong>Total budget</strong>: The number of evaluations that will occur.</li>
<li><strong>Number of batches</strong>: The number of batches per epoch of evaluation.</li>
<li><strong>Objective</strong>: String value which can be either <code>max</code> or <code>min</code>. Defines whether the objective should be maximised or minimised.</li>
<li><strong>Maximum number of classifiers</strong>: As it suggests, decides the upper limit of how many classifiers can be trained. This is optional, and usually not required to specify.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The total budget needs to be divisible by the number of batches, since all evaluations need to have the same number of samples.
This eases the training of models as well, since we can be sure of how many samples are present after each epoch.</p>
</div>
<p><strong>Evaluation Function</strong> receives 2 inputs :</p>
<ul>
<li><strong>Worker ID</strong>: Integer id that can be left alone when executing only on CPU or used to determine the iteration number in the current epoch of evaluation.</li>
<li><strong>Parameter OrderedDict</strong>: An OrderedDict which contains the (name, value) pairs of the Parameters passed to the engine.<ul>
<li>Since it is an ordered dict, if only the values are required, <code>list(parameters.values())</code> can be used to get the list of values in the same order as when the Parameters were declared to the engine.</li>
<li>These are the values of the sampled hyper parameters which have passed through the current cascade of models.</li>
</ul>
</li>
</ul>
<p>These parameters can be easily defined as :</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyshac</span>

<span class="c1"># define the parameters</span>
<span class="n">param_x</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">UniformContinuousHyperParameter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
<span class="n">param_y</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">UniformContinuousHyperParameter</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">param_x</span><span class="p">,</span> <span class="n">param_y</span><span class="p">]</span>

<span class="c1"># define the total budget as 100 evaluations</span>
<span class="n">total_budget</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># 100 evaluations at maximum</span>

<span class="c1"># define the number of batches</span>
<span class="n">num_batches</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># 10 samples per batch</span>

<span class="c1"># define the objective</span>
<span class="n">objective</span> <span class="o">=</span> <span class="s1">&#39;min&#39;</span>  <span class="c1"># minimize the squared loss</span>

<span class="n">shac</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">SHAC</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">total_budget</span><span class="p">,</span> <span class="n">num_batches</span><span class="p">,</span> <span class="n">objective</span><span class="p">)</span>
</pre></div>

<p>While this looks like a lot, these few lines are in essence all that is required to define the search space,
the evaluation measure and the engine.</p>
<h3 id="training-the-classifiers">Training the classifiers<a class="headerlink" href="#training-the-classifiers" title="Permanent link">&para;</a></h3>
<p>To train a classifier, the user must define an Evaluation function. This is a user defined function,
that accepts 2 or more inputs as defined by the engine, and returns a python floating point value.</p>
<p>The <strong>Evaluation Function</strong> receives at least 2 inputs :</p>
<ul>
<li><strong>Worker ID</strong>: Integer id that can be left alone when executing only on CPU or used to determine the iteration number in the current epoch of evaluation.</li>
<li><strong>Parameter OrderedDict</strong>: An OrderedDict which contains the (name, value) pairs of the Parameters passed to the engine.<ul>
<li>Since it is an ordered dict, if only the values are required, <code>list(parameters.values())</code> can be used to get the list of values in the same order as when the Parameters were declared to the engine.</li>
<li>These are the values of the sampled hyper parameters which have passed through the current cascade of models.</li>
</ul>
</li>
</ul>
<p>An example of a defined evaluation function :</p>
<div class="codehilite"><pre><span></span><span class="c1"># define the evaluation function</span>
<span class="k">def</span> <span class="nf">squared_error_loss</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
    <span class="n">y_sample</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>

    <span class="c1"># assume best values of x and y and 2 and 0 respectively</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="mf">4.</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y_sample</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">)</span>
</pre></div>

<p>Once the engine has been created, then it is simply a matter of calling <code>fit()</code> on the engine with the evaluation function
as the parameter. This will create the worker threads, generate the samples, test them if they pass all of the current
classifiers, prepare the dataset for that batch, test a cross validated classifier to see if it will train properly on
the dataset, finally train a classifier and then begin the next epoch.</p>
<div class="codehilite"><pre><span></span><span class="c1"># assuming shac here is from the above code inside __main__</span>
<span class="n">shac</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">squared_error_loss</span><span class="p">)</span>
</pre></div>

<p>There are a few cases to consider:</p>
<ul>
<li>There can be cases where the search space is not large enough to train the maximum number of classifier (usually 18).</li>
<li>There may be instances where we want to allow some relaxations of the constraint that the next batch must pass through all
of the previous classifiers. This allows classifiers to train on the same search space repeatedly rather than divide the search space.</li>
</ul>
<p>In these cases, we can utilize additional arguments to allow the training behaviour to better adapt to these circumstances.
These parameters are :</p>
<ul>
<li><strong>skip_cv_checks</strong>: As it suggests, if the number of samples per batch is too small, it is preferable to skip the cross validation check, as most classifiers will not pass them.</li>
<li><strong>early_stop</strong>: Determines whether training should halt as soon as an epoch of failed learning occurs. This is useful when evaluations are very costly.</li>
<li><strong>relax_checks</strong>: This will instead relax the constrain of having the sample pass through all classifiers to having the classifier past through most of the classifiers. In doing so, more samples can be obtained for the same search space.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># `early stopping` default is False, and it is preferred not to use it when using `relax checks`</span>
<span class="n">shac</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">squared_error_loss</span><span class="p">,</span> <span class="n">skip_cv_checks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">early_stop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">relax_checks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<h2 id="sampling-the-best-hyper-parameters">Sampling the best hyper parameters<a class="headerlink" href="#sampling-the-best-hyper-parameters" title="Permanent link">&para;</a></h2>
<p>Once the models have been trained by the engine, it is as simple as calling <code>predict()</code> to sample multiple samples or batches of parameters.</p>
<p>Samples can be obtained in a per instance or per batch (or even a combination) using the two parameters - <code>num_samples</code> and <code>num_batches</code>.</p>
<div class="codehilite"><pre><span></span><span class="c1"># sample a single instance of hyper parameters</span>
<span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">shac</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>  <span class="c1"># Gets 1 sample.</span>

<span class="c1"># sample multiple instances of hyper parameters</span>
<span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">shac</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Gets 10 samples.</span>

<span class="c1"># sample a batch of hyper parameters</span>
<span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">shac</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">num_batches</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Samples 5 batches, each containing 10 samples.</span>

<span class="c1"># sample multiple batches and a few additional instances of hyper parameters</span>
<span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">shac</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># Samples 5 batches (each containing 10 samples) and an additional 5 samples.</span>
</pre></div>

<h3 id="dealing-with-long-sampling-time">Dealing with long sampling time<a class="headerlink" href="#dealing-with-long-sampling-time" title="Permanent link">&para;</a></h3>
<p>When using a very large number of classifiers (default of 18), it may take an enormous amount of time to sample a single
hyper parameter list, let alone a batch. Therefore, it is more efficient to reduce the checks if necessary by using a few parameters.</p>
<ul>
<li>
<p><strong>num_workers_per_batch</strong>:</p>
<ul>
<li>When using a large number of samples or large number of classifiers, it is advisable to have many parallel workers sampling batches at the same time to reduce the amount of time taken to get samples that pass through all classifiers.</li>
<li>When using a small number of samples or small number of classifiers, it is advisable to reduce the time taken to sample each batch by reducing the number of parallel workers.</li>
<li>If left as <code>None</code>, will determine the value that was used during training.</li>
</ul>
</li>
<li>
<p><strong>relax_checks</strong>: Same as for training, relaxes the checks during evaluation to sample parameters faster.</p>
</li>
<li><strong>max_classfiers</strong>: Another way to reduce the time taken to sample parameters is to simply reduce the number of classifiers used to perform the check. This will use the first <code>K</code> classifier stages to perform the checks.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># number of sample is 16, so using 16 processes to sample in parallel is more efficient than the default memory conservative count.</span>
<span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">shac</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">num_workers_per_batch</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">relax_checks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_classfiers</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>

<h2 id="continuing-training">Continuing Training<a class="headerlink" href="#continuing-training" title="Permanent link">&para;</a></h2>
<p>As mentioned at the beginning of this guide, training can be stopped at any time after an epoch has finished.
After this, training run can be resumed from the last epoch successfully trained with only slight changes to how we
define and use the engine before using <code>fit()</code>.</p>
<p>There are a few steps, and a few important cautions that must be taken when continuing training :</p>
<ul>
<li>Create an instance of the engine in the same location as where the earlier model was trained.<ul>
<li>It must be provided the same evaluation measure as before.</li>
<li>It is optional to provide the hyper parameter list. It is not required as it will be replaced by the parameters in the file.</li>
<li>If training further, <strong>it is essential to use the same <code>total_budget</code>, <code>batch_size</code> and <code>objective</code> as before.</strong></li>
<li>If only evaluating the trained classifiers, using any value of <code>total_budget</code> is allowed (though the earlier value is better for consistency), however it must be divisible by <code>batch_size</code> and the <code>objective</code> must be same as before.</li>
<li>When restoring data, it must find the <code>shac</code> folder and all of the sub-folders in the same directory level.</li>
</ul>
</li>
<li>Call <code>restore_data()</code> on the engine. It will print out the number of samples and the number of classifiers it was able to find and load.</li>
<li>Call <code>fit()</code> or <code>predict()</code> as before.</li>
</ul>
<p>In doing so, the engine instance will be restored to the exact state as in the previous training session, and the new classifiers can be trained as normal.</p>
<p>Example :</p>
<div class="codehilite"><pre><span></span><span class="c1"># Reduced batch_size allows faster sampling</span>
<span class="c1"># None for the hyper parameter list as it will be loaded in the restoration step.</span>
<span class="n">new_shac</span> <span class="o">=</span> <span class="n">pyshac</span><span class="o">.</span><span class="n">SHAC</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">total_budget</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="n">objective</span><span class="p">)</span>

<span class="c1"># restore the engine</span>
<span class="n">new_shac</span><span class="o">.</span><span class="n">restore_data</span><span class="p">()</span>

<span class="c1"># predict or train like before</span>
<span class="n">new_shac</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">squared_error_loss</span><span class="p">)</span>

<span class="ow">or</span>

<span class="n">samples</span> <span class="o">=</span> <span class="n">new_shac</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../install/" title="Installation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Installation
              </span>
            </div>
          </a>
        
        
          <a href="../serial-execution/" title="Serial Evaluation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Serial Evaluation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>