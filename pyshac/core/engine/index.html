



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for PySHAC, the Python library for Sequential Halving and Classification.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.4, mkdocs-material-2.9.1">
    
    
      
        <title>SHAC - PySHAC Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.ba0fd1a6.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.6079476c.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="light-blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#shac-engine" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="PySHAC Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                PySHAC Documentation
              </span>
              <span class="md-header-nav__topic">
                SHAC
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/titu1994/pyshac/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    PySHAC Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/titu1994/pyshac/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../guide/" title="User Guide" class="md-nav__link">
      User Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../serial-execution/" title="Serial Evaluation" class="md-nav__link">
      Serial Evaluation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../managed/" title="Managed Engines" class="md-nav__link">
      Managed Engines
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../custom-hyper-parameters/" title="Custom Hyper Parameters" class="md-nav__link">
      Custom Hyper Parameters
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../external-dataset-training/" title="External Dataset Training" class="md-nav__link">
      External Dataset Training
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../callbacks/" title="Callbacks" class="md-nav__link">
      Callbacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Config
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Config
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../config/hyperparameters/" title="Hyper Parameters" class="md-nav__link">
      Hyper Parameters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../config/data/" title="Datasets" class="md-nav__link">
      Datasets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../config/callbacks/" title="Callbacks" class="md-nav__link">
      Callbacks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
    
    <label class="md-nav__link" for="nav-10">
      Core
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Core
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        SHAC
      </label>
    
    <a href="./" title="SHAC" class="md-nav__link md-nav__link--active">
      SHAC
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#note" title="Note" class="md-nav__link">
    Note
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-information" title="Class Information" class="md-nav__link">
    Class Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shac" title="SHAC" class="md-nav__link">
    SHAC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shac-methods" title="SHAC methods" class="md-nav__link">
    SHAC methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fit" title="fit" class="md-nav__link">
    fit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit_dataset" title="fit_dataset" class="md-nav__link">
    fit_dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predict" title="predict" class="md-nav__link">
    predict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_data" title="save_data" class="md-nav__link">
    save_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore_data" title="restore_data" class="md-nav__link">
    restore_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_num_parallel_generators" title="set_num_parallel_generators" class="md-nav__link">
    set_num_parallel_generators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_num_parallel_evaluators" title="set_num_parallel_evaluators" class="md-nav__link">
    set_num_parallel_evaluators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel_evaluators" title="parallel_evaluators" class="md-nav__link">
    parallel_evaluators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent_evaluators" title="concurrent_evaluators" class="md-nav__link">
    concurrent_evaluators
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../torch_engine/" title="PyTorch SHAC" class="md-nav__link">
      PyTorch SHAC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tf_engine/" title="Tensorflow SHAC" class="md-nav__link">
      Tensorflow SHAC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../keras_engine/" title="Keras SHAC" class="md-nav__link">
      Keras SHAC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Utils
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Utils
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/vis_utils/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#note" title="Note" class="md-nav__link">
    Note
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-information" title="Class Information" class="md-nav__link">
    Class Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shac" title="SHAC" class="md-nav__link">
    SHAC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shac-methods" title="SHAC methods" class="md-nav__link">
    SHAC methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fit" title="fit" class="md-nav__link">
    fit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit_dataset" title="fit_dataset" class="md-nav__link">
    fit_dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predict" title="predict" class="md-nav__link">
    predict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_data" title="save_data" class="md-nav__link">
    save_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore_data" title="restore_data" class="md-nav__link">
    restore_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_num_parallel_generators" title="set_num_parallel_generators" class="md-nav__link">
    set_num_parallel_generators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_num_parallel_evaluators" title="set_num_parallel_evaluators" class="md-nav__link">
    set_num_parallel_evaluators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel_evaluators" title="parallel_evaluators" class="md-nav__link">
    parallel_evaluators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent_evaluators" title="concurrent_evaluators" class="md-nav__link">
    concurrent_evaluators
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/titu1994/pyshac/edit/master/docs/core/engine.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="shac-engine">SHAC Engine<a class="headerlink" href="#shac-engine" title="Permanent link">&para;</a></h1>
<hr />
<p>The core algorithm from the paper <a href="https://arxiv.org/abs/1805.10255">Parallel Architecture and Hyperparameter Search via Successive Halving and Classification</a>.</p>
<p>This engine provides an interface similar to Scikit-Learn, with two methods - <code>fit</code> and <code>predict</code> which training and parameter sampling respectively.</p>
<p>The data for the classifiers is generated via rejection sampling, using Joblib for parallel batch generation and evaluation.
It even allows for halted training - such that training can resume from the previous stage without any issue.</p>
<p>Two important user inputs to this class are :</p>
<ul>
<li>Evaluation function</li>
<li>Hyper Parameter list</li>
</ul>
<hr />
<h2 id="note"><strong>Note</strong><a class="headerlink" href="#note" title="Permanent link">&para;</a></h2>
<p>The engine will generate samples at each epoch of training, and supply them to the evaluation function which will also be
executed in parallel. Therefore, all stages of sample generation, training, evaluation must be thread safe.</p>
<p>While the training algorithm can manage thread safety of the generator and training modules, the evaluation module is
for the user to write.</p>
<p>Therefore, we provide wrappers such as <code>TensorflowSHAC</code>, <code>KerasSHAC</code> and <code>TorchSHAC</code> to allow safer evaluation. However, this comes
at significant cost of execution, as a new Tensorflow Graph and likewise, a new Keras Session must be built for each evaluator thread.</p>
<div class="admonition info">
<p class="admonition-title">Serial Evaluation</p>
<p>If parallel evaluation is not preferred, please refer the <a href="../../serial-execution/">Serial Evaluation</a> page.</p>
</div>
<h2 id="class-information">Class Information<a class="headerlink" href="#class-information" title="Permanent link">&para;</a></h2>
<hr />
<p><span style="float:right;"><a href="https://github.com/titu1994/pyshac/blob/master/pyshac/core/engine.py#L1062">[source]</a></span></p>
<h2 id="shac"><a href="#shac">SHAC</a><a class="headerlink" href="#shac" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="n">pyshac</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SHAC</span><span class="p">(</span><span class="n">hyperparameter_list</span><span class="p">,</span> <span class="n">total_budget</span><span class="p">,</span> <span class="n">num_batches</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">max_classifiers</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="s1">&#39;shac&#39;</span><span class="p">)</span>
</pre></div>

<p>The default and generic implementation of the SHAC algorithm. It is a wrapper over the
abstract class, and performs no additional maintenance over the evaluation function.</p>
<p>It is fastest engine, but assumes that the evaluation function is thread safe and
the system has sufficient memory to run several copies of the evaluation function
at the same time.</p>
<p>This engine is suitable for Numpy / PyTorch based work. Both numpy and PyTorch
dynamically allocate memory, and therefore, as long as the system has enough memory
to run multiple copies of the evaluation model, there is no additional memory management
to be done.</p>
<p>Still, for PyTorch, the number of evaluation processes should be carefully set,
so as not to exhaust all CPU / GPU memory during execution.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><strong>evaluation_function ((int, list) -&gt; float):</strong> The evaluation function is passed
    only the integer id (of the worker) and the sampled hyper parameters in
    an OrderedDict.  The evaluation function is expected to pass a python
    floating point number representing the evaluated value.</li>
<li><strong>hyperparameter_list (hp.HyperParameterList | None):</strong> A list of parameters
    (or a HyperParameterList) that are passed to define the search space.
    Can be None, so that it is loaded from disk instead.</li>
<li><strong>total_budget (int):</strong> <code>N</code>. Defines the total number of models to evaluate.</li>
<li><strong>num_batches (int):</strong> <code>M</code>. Defines the number of batches the work is distributed
    to. Must be set such that <code>total budget</code> is divisible by <code>batch size</code>.</li>
<li><strong>objective (str):</strong> Can be <code>max</code> or <code>min</code>. Whether to maximise
    the evaluation measure or minimize it.</li>
<li><strong>max_classifiers (int):</strong> Maximum number of classifiers that
    are trained. Default (18) is according to the paper.</li>
<li><strong>save_dir (str):</strong> The base directory where the data of the engine
    will be stored.</li>
</ul>
<p><strong>References:</strong></p>
<ul>
<li><a href="https://arxiv.org/abs/1805.10255">Parallel Architecture and Hyperparameter Search via Successive Halving and Classification</a></li>
</ul>
<p><strong>Raises:</strong></p>
<ul>
<li><strong>ValueError</strong>: If <code>total budget</code> is not divisible by <code>batch size</code>.</li>
</ul>
<hr />
<h2 id="shac-methods">SHAC methods<a class="headerlink" href="#shac-methods" title="Permanent link">&para;</a></h2>
<h3 id="fit">fit<a class="headerlink" href="#fit" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">fit</span><span class="p">(</span><span class="n">eval_fn</span><span class="p">,</span> <span class="n">skip_cv_checks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">early_stop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">relax_checks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>

<p>Generated batches of samples, trains <code>total_classifiers</code> number of XGBoost models
and evaluates each batch with the supplied function in parallel.</p>
<p>Allows manually changing the number of processes that are used to generate samples
or to evaluate them. While the defaults generally work well, further performance
gains can be had by trying different values according to the limits of the system.</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">eval</span> <span class="o">=</span> <span class="k">lambda</span> <span class="nb">id</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shac</span> <span class="o">=</span> <span class="n">SHAC</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">total_budget</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">num_batches</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">shac</span><span class="o">.</span><span class="n">set_num_parallel_generators</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># change the number of generator process</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shac</span><span class="o">.</span><span class="n">set_num_parallel_evaluators</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># change the number of evaluator processes</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shac</span><span class="o">.</span><span class="n">generator_backend</span> <span class="o">=</span> <span class="s1">&#39;multiprocessing&#39;</span>  <span class="c1"># change the backend for the generator (default is `multiprocessing`)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">shac</span><span class="o">.</span><span class="n">concurrent_evaluators</span><span class="p">()</span>  <span class="c1"># change the backend of the evaluator to use `threading`</span>
</pre></div>

<p>Has an adaptive behaviour based on what epoch it is on, since later epochs require
far more number of samples to generate a single batch of samples. When the epoch
number increases beyond 10, it doubles the number of generator processes.</p>
<p>This adaptivity can be removed by setting the parameter <code>limit_memory</code> to True.
<div class="codehilite"><pre><span></span>&gt;&gt;&gt; shac.limit_memory = True
</pre></div></p>
<p><strong>Arguments:</strong></p>
<ul>
<li><strong>evaluation_function ((int, list) -&gt; float):</strong> The evaluation function is passed
    only the integer id (of the worker) and the sampled hyper parameters in
    an OrderedDict.  The evaluation function is expected to pass a python
    floating point number representing the evaluated value.</li>
<li><strong>skip_cv_checks (bool):</strong> If set, will not perform 5 fold cross validation check
    on the models before adding them to the classifer list. Useful when the
    batch size is small.</li>
<li><strong>early_stop (bool):</strong> Stop running if fail to find a classifier that beats the
    last stage of evaluations.</li>
<li><strong>relax_checks (bool):</strong> If set, will allow samples who do not pass all of the
    checks from all classifiers. Can be useful when large number of models
    are present and remaining search space is not big enough to allow sample
    to pass through all checks.</li>
<li><strong>callbacks (list | None):</strong> Optional list of callbacks that are executed when
    the engine is being trained. <code>History</code> callback is automatically added
    for all calls to <code>fit</code>.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>A <code>History</code> object which tracks all the important information
during training, and can be accessed using <code>history.history</code>
as a dictionary.</p>
<hr />
<h3 id="fit_dataset">fit_dataset<a class="headerlink" href="#fit_dataset" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">fit_dataset</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">skip_cv_checks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">early_stop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">presort</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>

<p>Uses the provided dataset file to train the engine, instead of using
the sequentual halving and classification algorithm directly. The data
provided in the path must strictly follow the format of the dataset
maintained by the engine.</p>
<p><strong>Standard format of datasets:</strong></p>
<p>Each dataset csv file must contain an integer id column named "id"
as its 1<sup>st</sup> column, followed by several columns describing the values
taken by the hyper parameters, and the final column must be for
the the objective criterion, and <em>must</em> be named "scores".</p>
<p>The csv file <em>must</em> contain a header, following the above format.</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span>id,hp1,hp2,scores
0,1,h1,1.0
1,1,h2,0.2
2,0,h1,0.0
3,0,h3,0.5
...
</pre></div>


<p><strong>Arguments:</strong></p>
<ul>
<li><strong>dataset_path (str):</strong> The full or relative path to a csv file
    containing the values of the dataset.</li>
<li><strong>skip_cv_checks (bool):</strong> If set, will not perform 5 fold cross
    validation check on the models before adding them to the
    classifer list. Useful when the batch size is small.</li>
<li><strong>early_stop (bool):</strong> Stop running if fail to find a classifier
    that beats the last stage of evaluations.</li>
<li><strong>presort (bool):</strong> Boolean flag to determine whether to sort
    the values of the dataset prior to loading. Ascending or
    descending sort is selected based on whether the engine
    is maximizing or minimizing the objective. It is preferable
    to set this always, to train better classifiers.</li>
<li><strong>callbacks (list | None):</strong> Optional list of callbacks that are executed when
    the engine is being trained. <code>History</code> callback is automatically added
    for all calls to <code>fit_dataset</code>.</li>
</ul>
<p><strong>Raises:</strong></p>
<ul>
<li><strong>ValueError</strong>: If the number of hyper parameters in the file
    are not the same as the number of hyper parameters
    that are available to the engine or if the number of
    samples in the provided dataset are less than the
    required number of samples by the engine.</li>
<li><strong>FileNotFoundError</strong>: If the dataset is not available at the
    provided filepath.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>A <code>History</code> object which tracks all the important information
during training, and can be accessed using <code>history.history</code>
as a dictionary.</p>
<hr />
<h3 id="predict">predict<a class="headerlink" href="#predict" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">predict</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">num_batches</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">num_workers_per_batch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relax_checks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">max_classfiers</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>

<p>Using trained classifiers, sample the search space and predict which samples
can successfully pass through the cascade of classifiers.</p>
<p>When using a full cascade of 18 classifiers, a vast amount of time to sample
a single sample.</p>
<div class="admonition note">
<p class="admonition-title">Sample mode vs Batch mode</p>
</div>
<p>Parameters can be generated in either sample mode or batch mode or any combination
of the two.</p>
<p><code>num_samples</code> is on a per sample basis (1 sample generated per count). Can be <code>None</code> or an int &gt;= 0.
<code>num_batches</code> is on a per batch basis (M samples generated per count). Can be <code>None</code> or an integer &gt;= 0.</p>
<p>The two are combined to produce a total number of samples which are provided in a
list.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><strong>num_samples (None | int):</strong> Number of samples to be generated.</li>
<li><strong>num_batches (None | int):</strong> Number of batches of samples to be generated.</li>
<li><strong>num_workers_per_batch (int):</strong> Determines how many parallel threads / processes
    are created to generate the batches. For small batches, it is best to use 1.
    If left as <code>None</code>, defaults to <code>num_parallel_generators</code>.</li>
<li><strong>relax_checks (bool):</strong> If set, will allow samples who do not pass all of the
    checks from all classifiers. Can be useful when large number of models
    are present and remaining search space is not big enough to allow sample
    to pass through all checks.</li>
<li><strong>max_classfiers (int | None):</strong> Number of classifiers to use for sampling.
    If set to None, will use all classifiers.</li>
</ul>
<p><strong>Raises:</strong></p>
<ul>
<li><strong>ValueError</strong>: If <code>max_classifiers</code> is larger than the number of available
    classifiers.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>batches of samples in the form of an OrderedDict</p>
<hr />
<h3 id="save_data">save_data<a class="headerlink" href="#save_data" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">save_data</span><span class="p">()</span>
</pre></div>

<p>Serialize the class objects by serializing the dataset and the trained models.</p>
<hr />
<h3 id="restore_data">restore_data<a class="headerlink" href="#restore_data" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">restore_data</span><span class="p">()</span>
</pre></div>

<p>Recover the serialized class objects by loading the dataset and the trained models
from the default save directories.</p>
<hr />
<h3 id="set_num_parallel_generators">set_num_parallel_generators<a class="headerlink" href="#set_num_parallel_generators" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">set_num_parallel_generators</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>

<p>Check and sets the number of parallel generators. If None, checks if the number
of workers exceeds the number of virtual cores. If it does, it warns about it
and sets the max parallel generators to be the number of cores.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><strong>n (int | None):</strong> The number of parallel generators required.</li>
</ul>
<hr />
<h3 id="set_num_parallel_evaluators">set_num_parallel_evaluators<a class="headerlink" href="#set_num_parallel_evaluators" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">set_num_parallel_evaluators</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>

<p>Check and sets the number of parallel evaluators. If None, checks if the number
of workers exceeds the number of virtual cores. If it does, it warns about it
and sets the max parallel generators to be the number of cores.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><strong>n (int | None):</strong> The number of parallel evaluators required.</li>
</ul>
<hr />
<h3 id="parallel_evaluators">parallel_evaluators<a class="headerlink" href="#parallel_evaluators" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">parallel_evaluators</span><span class="p">()</span>
</pre></div>

<p>Sets the evaluators to use the <code>loky</code> backend.</p>
<p>The user must take the responsibility of thread safety and memory management.</p>
<hr />
<h3 id="concurrent_evaluators">concurrent_evaluators<a class="headerlink" href="#concurrent_evaluators" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">concurrent_evaluators</span><span class="p">()</span>
</pre></div>

<p>Sets the evaluators to use the threading backend, and therefore
be locked by Python's GIL.</p>
<p>While technically still "parallel", it is in fact concurrent execution
rather than parallel execution of the evaluators.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../config/callbacks/" title="Callbacks" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Callbacks
              </span>
            </div>
          </a>
        
        
          <a href="../torch_engine/" title="PyTorch SHAC" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                PyTorch SHAC
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>